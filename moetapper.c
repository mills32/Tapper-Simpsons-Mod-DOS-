/*
##############################
TAPPER MS_DOS GRAPHICS MODDER#
##############################

Use tapper from total dos collection, game was converted to tapper.exe + bunch of data files.

Sprites are organized like this: sprite1, sprite1 mask... Transparent pixels are black on the sprite,
and white on the sprite mask.

Background dancers have no mask, nor transparent parts.

Background images seem to have rle compresion, but I could not understand it, and they also work 
without compression, 1/2 bit pixels stored from 0x14 position on.

Input images are bmps and they are all inverted, because bmp file data is inverted.

FILES
-----

RGBI / CGA 4 COLOR GRAPHICS:

	-RGBIDATA.001 = ?
	-RGBIDATA.002 = BKG0 (Logo Screen)
	-RGBIDATA.003 = 30 Client Sprites
	-RGBIDATA.004 = 33 BARMAN /MOE sprites
	-RGBIDATA.005 = 7 Background dancers (they are shown when taking tips)
	-RGBIDATA.006 = Doors drawn on top of clients (I deleted them to rearrange scenes)
	-RGBIDATA.007 = 21 Misc Sprites
	-RGBIDATA.008 = BKG1 (Can mini game)
	-RGBIDATA.009 = BKG2 (Bar)
	-RGBIDATA.010 = BKG3 (Baseball)
	-RGBIDATA.011 = BKG4 (Bar 2)
	-RGBIDATA.012 = BKG5 (Bar 2.1)
	-RGBIDATA.013 = BKG6 (Space)
	-RGBIDATA.014 = BKG7 (Space 1)
	
	
NTSC / CGA 16 COLOR GRAPHICS (COMPOSITE):

	-NTSCDATA.001 = ?
	-NTSCDATA.002 = BKG0 (Logo Screen)
	-NTSCDATA.003 = 30 Client Sprites
	-NTSCDATA.004 = 30 Client Sprites (flip)
	-NTSCDATA.005 = 33 BARMAN /MOE sprites
	-NTSCDATA.006 = 25 BARMAN /MOE sprites (the ones that need flipped versions)
	-NTSCDATA.007 = 7 Background dancers (they are shown when taking tips)
	-NTSCDATA.008 = 7 Background dancers (flip)
	-NTSCDATA.009 = Doors drawn on top of clients (I deleted them to rearrange scenes)
	-NTSCDATA.010 = 21 Misc Sprites
	-NTSCDATA.011 = BKG1 (Can mini game)
	-NTSCDATA.012 = BKG2 (bar)
	-NTSCDATA.013 = BKG2 (Bar flip)
	-NTSCDATA.014 = BKG3 (Baseball)
	-NTSCDATA.015 = BKG4 (Bar 2)
	-NTSCDATA.016 = BKG4 (Bar 2.1)
	-NTSCDATA.017 = BKG5 (Space)
	-NTSCDATA.018 = BKG6 (Space 1)
*/


#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <math.h>


void Insert_RGBI_Clients(){
	int i,j,k;
	unsigned long lines = 0;
	unsigned long offset = 0;
	unsigned char sprite[16];
	unsigned short pix,p0,p1,p2,p3;
	FILE *fin = fopen("Clients.bmp","rb");
	FILE *fout = fopen("RGBIDATA.003","wb");
	fseek(fin,0x7A,SEEK_SET);
	fseek(fout,0xA2 ,SEEK_SET);
	
	//16x16x60 frames
	for (i = 0; i < 80; i++){
		for (j = 0; j < 16; j++){//16 lines
			for (k = 0; k < 16/4; k++){//16 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc( (p0<<6) | (p1<<4) | (p2<<2) | (p3),fout);
			}
			fseek(fin,16,SEEK_CUR);
			if (j == 7) fseek(fin,-15*16,SEEK_CUR);
		}
		fseek(fin,-16,SEEK_CUR);
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header[] = {
		0x50,0x00,0xA2,0x00,0xE2,0x00,0x22,0x01,0x62,0x01,0xA2,0x01,0xE2,0x01,0x22,0x02,
		0x62,0x02,0xA2,0x02,0xE2,0x02,0x22,0x03,0x62,0x03,0xA2,0x03,0xE2,0x03,0x22,0x04,
		0x62,0x04,0xA2,0x04,0xE2,0x04,0x22,0x05,0x62,0x05,0xA2,0x05,0xE2,0x05,0x22,0x06,
		0x62,0x06,0xA2,0x06,0xE2,0x06,0x22,0x07,0x62,0x07,0xA2,0x07,0xE2,0x07,0x22,0x08,
		0x62,0x08,0xA2,0x08,0xE2,0x08,0x22,0x09,0x62,0x09,0xA2,0x09,0xE2,0x09,0x22,0x0A,
		0x62,0x0A,0xA2,0x0A,0xE2,0x0A,0x22,0x0B,0x62,0x0B,0xA2,0x0B,0xE2,0x0B,0x22,0x0C,
		0x62,0x0C,0xA2,0x0C,0xE2,0x0C,0x22,0x0D,0x62,0x0D,0xA2,0x0D,0xE2,0x0D,0x22,0x0E,
		0x62,0x0E,0xA2,0x0E,0xE2,0x0E,0x22,0x0F,0x62,0x0F,0xA2,0x0F,0xE2,0x0F,0x22,0x10,
		0x62,0x10,0xA2,0x10,0xE2,0x10,0x22,0x11,0x62,0x11,0xA2,0x11,0xE2,0x11,0x22,0x12,
		0x62,0x12,0xA2,0x12,0xE2,0x12,0x22,0x13,0x62,0x13,0xA2,0x13,0xE2,0x13,0x22,0x14,
		0x62,0x14
	};
	
	fwrite(header,sizeof(unsigned char),0xA2,fout);
	
	
	fclose(fin);
	fclose(fout);
}

void Insert_RGBI_Misc(){
	int i,j,k;
	unsigned long lines = 0;
	unsigned long offset = 0;
	unsigned char sprite[16];
	unsigned short pix,p0,p1,p2,p3;
	FILE *fin = fopen("Misc.bmp","rb");
	FILE *fout = fopen("RGBIDATA.007","wb");
	fseek(fin,0x7A,SEEK_SET);
	fseek(fout,0xF4 ,SEEK_SET);
	
	//16x12  12 frames (beer jar)
	for (i = 0; i < 12; i++){
		for (j = 0; j < 12; j++){//12 lines
			for (k = 0; k < 16/4; k++){//16 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc( (p0<<6) | (p1<<4) | (p2<<2) | (p3),fout);
			}
			fseek(fin,16+32,SEEK_CUR);
			if (j == 5) fseek(fin,-11*32,SEEK_CUR);
		}
		fseek(fin,-32,SEEK_CUR);
	}
	
	//12x16  2 frames (beer can)
	for (i = 0; i < 2; i++){
		for (j = 0; j < 16; j++){//16 lines
			for (k = 0; k < 12/4; k++){//12 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc( (p0<<6) | (p1<<4) | (p2<<2) | (p3),fout);
			}
			fseek(fin,20+32,SEEK_CUR);
			if (j == 7) fseek(fin,-15*32,SEEK_CUR);
		}
		fseek(fin,-32,SEEK_CUR);
	}
	
	//16x16  2 frames (bart)
	for (i = 0; i < 2; i++){
		for (j = 0; j < 16; j++){//16 lines
			for (k = 0; k < 16/4; k++){//12 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc( (p0<<6) | (p1<<4) | (p2<<2) | (p3),fout);
			}
			fseek(fin,16+32,SEEK_CUR);
			if (j == 7) fseek(fin,-15*32,SEEK_CUR);
		}
		fseek(fin,-32,SEEK_CUR);
	}
	
	//32x22  4 frames (bart + can)
	for (i = 0; i < 4; i++){
		for (j = 0; j < 22; j++){//22 lines
			for (k = 0; k < 32/4; k++){//32 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc( (p0<<6) | (p1<<4) | (p2<<2) | (p3),fout);
			}
			fseek(fin,32,SEEK_CUR);
			if (j == 10) fseek(fin,-21*32,SEEK_CUR);
		}
		fseek(fin,-32,SEEK_CUR);
	}
	
	//16x6  2 frames (unknown?)
	for (i = 0; i < 2; i++){
		for (j = 0; j < 6; j++){//6 lines
			for (k = 0; k < 16/4; k++){//16 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc( (p0<<6) | (p1<<4) | (p2<<2) | (p3),fout);
			}
			fseek(fin,16+32,SEEK_CUR);
			if (j == 2) fseek(fin,-5*32,SEEK_CUR);
		}
		fseek(fin,-32,SEEK_CUR);
	}
	
	//8x8  12 frames (coins ?)
	for (i = 0; i < 12; i++){
		for (j = 0; j < 8; j++){//8 lines
			for (k = 0; k < 8/4; k++){//8 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc( (p0<<6) | (p1<<4) | (p2<<2) | (p3),fout);
			}
			fseek(fin,24+32,SEEK_CUR);
			if (j == 3) fseek(fin,-7*32,SEEK_CUR);
		}
		fseek(fin,-32,SEEK_CUR);
	}
	
	//16x16  8 frames (explosion and falling jarjar)
	for (i = 0; i < 8; i++){
		for (j = 0; j < 16; j++){//12 lines
			for (k = 0; k < 16/4; k++){//16 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc( (p0<<6) | (p1<<4) | (p2<<2) | (p3),fout);
			}
			fseek(fin,16+32,SEEK_CUR);
			if (j == 7) fseek(fin,-15*32,SEEK_CUR);
		}
		fseek(fin,-32,SEEK_CUR);
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header[] = {
		0x19,0x00,0x54,0x00,0x34,0x00,0xB4,0x00,0x94,0x00,0xF4,0x00,0x54,0x01,0xB4,0x01,
		0x14,0x02,0x74,0x02,0xD4,0x02,0x34,0x03,0x94,0x03,0x14,0x04,0x74,0x05,0xD4,0x06,
		0x44,0x07,0x24,0x07,0x04,0x07,0xA4,0x07,0x84,0x07,0x64,0x07,0xC4,0x07,0x44,0x08,
		0xC4,0x08,0x44,0x09,0x00,0x00,0x32,0x30,0xFF,0xFC,0xEA,0xAC,0x08,0xC0,0x8C,0xC8,
		0xEA,0xAC,0xEA,0xAC,0xFF,0xFC,0xF2,0x3C,0xFF,0xFC,0xEA,0xAC,0xF8,0xFC,0x8C,0xC8,
		0xEA,0xAC,0xEA,0xAC,0x00,0x00,0x00,0x00,0xFF,0xFC,0xEF,0x2C,0x00,0x00,0x00,0xA0,
		0xC3,0xCC,0xEA,0xAC,0xFF,0xFF,0xFF,0x3F,0xFF,0xFC,0xEF,0xEC,0xFF,0xFF,0x00,0xA3,
		0xFF,0xFC,0xEA,0xAC,0x00,0x00,0x00,0x00,0xFF,0xFC,0xC0,0x0C,0x00,0x00,0x00,0x00,
		0xC0,0x0C,0xCB,0x0C,0xFF,0xFF,0xFF,0xFF,0xFF,0xFC,0xFF,0xFC,0xFF,0xFF,0x00,0x03,
		0xFF,0xFC,0xFB,0xFC,0x00,0x00,0x0C,0x8C,0x3F,0xFF,0x3A,0xAB,0x03,0x20,0x23,0x32,
		0x3A,0xAB,0x3A,0xAB,0x3F,0xFF,0x3C,0x8F,0x3F,0xFF,0x3A,0xAB,0x3F,0x2F,0x23,0x32,
		0x3A,0xAB,0x3A,0xAB,0x00,0x00,0x00,0x00,0x3F,0xFF,0x38,0xFB,0x00,0x00,0x0A,0x00,
		0x33,0xC3,0x3A,0xAB,0xFF,0xFF,0xFC,0xFF,0x3F,0xFF,0x3B,0xFB,0xFF,0xFF,0xCA,0x00,
		0x3F,0xFF,0x3A,0xAB,0x00,0x00,0x00,0x00,0x3F,0xFF,0x30,0x03,0x00,0x00,0x00,0x00,
		0x30,0x03,0x30,0xE3,0xFF,0xFF,0xFF,0xFF,0x3F,0xFF,0x3F,0xFF,0xFF,0xFF,0xC0,0x00,
		0x3F,0xFF,0x3F,0xEF
	};
	
	fwrite(header,sizeof(unsigned char),0xF4,fout);
	
	
	fclose(fin);
	fclose(fout);
}

void Insert_RGBI_Moe(){
	int i,j,k;
	unsigned long lines = 0;
	unsigned long offset = 0;
	unsigned char sprite[16];
	unsigned short pix,p0,p1,p2,p3;
	FILE *fin = fopen("Moe.bmp","rb");
	FILE *fout = fopen("RGBIDATA.004","wb");
	fseek(fin,0x7A,SEEK_SET);
	fseek(fout,0x86 ,SEEK_SET);
	
	//32x16x66 frames
	for (i = 0; i < 66; i++){
		for (j = 0; j < 16; j++){//16 lines
			for (k = 0; k < 32/4; k++){//32 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc( (p0<<6) | (p1<<4) | (p2<<2) | (p3),fout);
			}
			fseek(fin,32,SEEK_CUR);
			if (j == 7) fseek(fin,-15*32,SEEK_CUR);
		}
		fseek(fin,-32,SEEK_CUR);
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header[] = {
		0x42,0x00,0x86,0x00,0x06,0x01,0x86,0x01,0x06,0x02,0x86,0x02,0x06,0x03,0x86,0x03,
		0x06,0x04,0x86,0x04,0x06,0x05,0x86,0x05,0x06,0x06,0x86,0x06,0x06,0x07,0x86,0x07,
		0x06,0x08,0x86,0x08,0x06,0x09,0x86,0x09,0x06,0x0A,0x86,0x0A,0x06,0x0B,0x86,0x0B,
		0x06,0x0C,0x86,0x0C,0x06,0x0D,0x86,0x0D,0x06,0x0E,0x86,0x0E,0x06,0x0F,0x86,0x0F,
		0x06,0x10,0x86,0x10,0x06,0x11,0x86,0x11,0x06,0x12,0x86,0x12,0x06,0x13,0x86,0x13,
		0x06,0x14,0x86,0x14,0x06,0x15,0x86,0x15,0x06,0x16,0x86,0x16,0x06,0x17,0x86,0x17,
		0x06,0x18,0x86,0x18,0x06,0x19,0x86,0x19,0x06,0x1A,0x86,0x1A,0x06,0x1B,0x86,0x1B,
		0x06,0x1C,0x86,0x1C,0x06,0x1D,0x86,0x1D,0x06,0x1E,0x86,0x1E,0x06,0x1F,0x86,0x1F,
		0x06,0x20,0x86,0x20,0x06,0x21
	};
	
	fwrite(header,sizeof(unsigned char),0x86,fout);
	
	
	fclose(fin);
	fclose(fout);
}

void Insert_RGBI_Dancers(){
	int i,j,k;
	unsigned long lines = 0;
	unsigned long offset = 0;
	unsigned char sprite[16];
	unsigned short pix,p0,p1,p2,p3;
	FILE *fin = fopen("Dancers.bmp","rb");
	FILE *fout = fopen("RGBIDATA.005","wb");
	fseek(fin,0x7A,SEEK_SET);
	fseek(fout,0x10,SEEK_SET);
	
	//56x32x7 frames
	
	for (i = 0; i < 7; i++){
		for (j = 0; j < 32; j++){//32 lines
			for (k = 0; k < 56/4; k++){//56 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc( (p0<<6) | (p1<<4) | (p2<<2) | (p3),fout);
			}
			fseek(fin,56,SEEK_CUR);
			if (j == 15) fseek(fin,-31*56,SEEK_CUR);
		}
		fseek(fin,-56,SEEK_CUR);
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header[] = {
		0x07,0x00,0x10,0x00,0xD0,0x01,0x90,0x03,0x50,0x05,0x10,0x07,0xD0,0x08,0x90,0x0A
	};
	
	fwrite(header,sizeof(unsigned char),0x10,fout);
	
	
	fclose(fin);
	fclose(fout);
}

void Delete_RGBI_Doors(){
	int i,j,k;
	unsigned long lines = 0;
	unsigned long offset = 0;
	unsigned char sprite[16];
	unsigned short pix,p0,p1,p2,p3;
	FILE *fout = fopen("RGBIDATA.006","wb");
	fseek(fout,0x42,SEEK_SET);
	
	//24x22  x32 frames
	
	for (i = 0; i < 16; i++){
		for (j = 0; j < 22*(24/4); j++)fputc(0x00,fout);//22 lines
		for (j = 0; j < 22*(24/4); j++)fputc(0xFF,fout);//22 lines	
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header[] = {
		0x20,0x00,0x42,0x00,0xC6,0x00,0x4A,0x01,0xCE,0x01,0x52,0x02,0xD6,0x02,0x5A,0x03,
		0xDE,0x03,0x62,0x04,0xE6,0x04,0x6A,0x05,0xEE,0x05,0x72,0x06,0xF6,0x06,0x7A,0x07,
		0xFE,0x07,0x82,0x08,0x06,0x09,0x8A,0x09,0x0E,0x0A,0x92,0x0A,0x16,0x0B,0x9A,0x0B,
		0x1E,0x0C,0xA2,0x0C,0x26,0x0D,0xAA,0x0D,0x2E,0x0E,0xB2,0x0E,0x36,0x0F,0xBA,0x0F,
		0x3E,0x10
	};
	
	fwrite(header,sizeof(unsigned char),0x42,fout);
	
	fclose(fout);
}

void Insert_RGBI_BKG(const char *bmp,const char *data, int pal){
	int i,j;
	unsigned long offset = 0;
	unsigned short line = 0;
	unsigned char pix1,pix2,pix3,pix4;
	FILE *fin = fopen(bmp,"rb");
	FILE *fout = fopen(data,"wb");

	//Write even lines
	fseek(fin,0x7A,SEEK_SET);
	fseek(fout,0x12,SEEK_SET);
	
	//Some padding
	fputc(0x77,fout);fputc(0x77,fout);
	
	while (offset < 80*101){
		pix1 = fgetc(fin);pix2 = fgetc(fin);pix3 = fgetc(fin);pix4 = fgetc(fin);
		fputc((pix1<<6) | (pix2<<4) | (pix3<<2) | (pix4),fout);
		offset++;
		line++;
		if (line == 80) {line = 0; fseek(fin,320,SEEK_CUR);}
	}
	
	//Some padding
	for (int i = 1; i < 113; i++) fputc(0x77,fout);
	
	//Write odd lines
	offset = 0;
	line = 0;
	fseek(fin,0x7A+320,SEEK_SET);
	
	while (offset < 80*100){
		pix1 = fgetc(fin);pix2 = fgetc(fin);pix3 = fgetc(fin);pix4 = fgetc(fin);
		fputc((pix1<<6) | (pix2<<4) | (pix3<<2) | (pix4),fout);
		offset++;
		line++;
		if (line == 80) {line = 0; fseek(fin,320,SEEK_CUR);}
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header0[] = {//Pal 0 (black, cyan, pink, white)
		0x10,0x09,0xF7,0xDF,0x66,0x55,0x66,0x99,0x77,0x99,0x77,0x66,0x77,0xDD,0xCC,0x33,0xEB,0xBE
	};
	unsigned char header1[] = {//Pal 1 (black, cyan, red, white)
		0x10,0x0B,0x41,0x14,0x82,0x28,0xC3,0x3C,0x99,0x66,0xEB,0xBE,0x7D,0xD7,0xEE,0xBB,0xDD,0x77
	};
	unsigned char header2[] = {//Pal 2 (blue, green, red, yellow)
		0x19,0x08,0xEB,0xBE,0xEF,0xFB,0xEE,0xFF,0xEF,0xFF,0x77,0x55,0x22,0x44,0x33,0x44,0x33,0x88
	};
	if (pal == 0)fwrite(header0,sizeof(unsigned char),0x12,fout);
	if (pal == 1)fwrite(header1,sizeof(unsigned char),0x12,fout);
	if (pal == 2)fwrite(header2,sizeof(unsigned char),0x12,fout);
	
	fclose(fin);
	fclose(fout);
}


///////////
//Composite
///////////
void Insert_NTSC_Clients(const char *bmp,const char *data){
	int i,j,k;
	unsigned long lines = 0;
	unsigned long offset = 0;
	unsigned char sprite[16];
	unsigned short pix,p0,p1,p2,p3;
	FILE *fin = fopen(bmp,"rb");
	FILE *fout = fopen(data,"wb");
	fseek(fin,0x7A,SEEK_SET);
	fseek(fout,0xA2 ,SEEK_SET);
	
	//8x16x60 frames
	
	for (i = 0; i < 80; i++){
		for (j = 0; j < 16; j++){//16 lines
			for (k = 0; k < 8/4; k++){//8 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc((p0<<4) | p1,fout);fputc((p2<<4) | p3,fout);
			}
			fseek(fin,8,SEEK_CUR);
			if (j == 7) fseek(fin,-15*8,SEEK_CUR);
		}
		fseek(fin,-8,SEEK_CUR);
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header[] = {
		0x50,0x00,0xA2,0x00,0xE2,0x00,0x22,0x01,0x62,0x01,0xA2,0x01,0xE2,0x01,0x22,0x02,
		0x62,0x02,0xA2,0x02,0xE2,0x02,0x22,0x03,0x62,0x03,0xA2,0x03,0xE2,0x03,0x22,0x04,
		0x62,0x04,0xA2,0x04,0xE2,0x04,0x22,0x05,0x62,0x05,0xA2,0x05,0xE2,0x05,0x22,0x06,
		0x62,0x06,0xA2,0x06,0xE2,0x06,0x22,0x07,0x62,0x07,0xA2,0x07,0xE2,0x07,0x22,0x08,
		0x62,0x08,0xA2,0x08,0xE2,0x08,0x22,0x09,0x62,0x09,0xA2,0x09,0xE2,0x09,0x22,0x0A,
		0x62,0x0A,0xA2,0x0A,0xE2,0x0A,0x22,0x0B,0x62,0x0B,0xA2,0x0B,0xE2,0x0B,0x22,0x0C,
		0x62,0x0C,0xA2,0x0C,0xE2,0x0C,0x22,0x0D,0x62,0x0D,0xA2,0x0D,0xE2,0x0D,0x22,0x0E,
		0x62,0x0E,0xA2,0x0E,0xE2,0x0E,0x22,0x0F,0x62,0x0F,0xA2,0x0F,0xE2,0x0F,0x22,0x10,
		0x62,0x10,0xA2,0x10,0xE2,0x10,0x22,0x11,0x62,0x11,0xA2,0x11,0xE2,0x11,0x22,0x12,
		0x62,0x12,0xA2,0x12,0xE2,0x12,0x22,0x13,0x62,0x13,0xA2,0x13,0xE2,0x13,0x22,0x14,
		0x62,0x14
	};
	
	fwrite(header,sizeof(unsigned char),0xA2,fout);
	
	
	fclose(fin);
	fclose(fout);
}

void Insert_NTSC_Misc(){
	int i,j,k;
	unsigned long lines = 0;
	unsigned long offset = 0;
	unsigned char sprite[16];
	unsigned short pix,p0,p1,p2,p3;
	FILE *fin = fopen("MiscColor.bmp","rb");
	FILE *fout = fopen("NTSCDATA.010","wb");
	fseek(fin,0x7A,SEEK_SET);
	fseek(fout,0xB4 ,SEEK_SET);
	
	//8x12  12 frames (beer jar)
	for (i = 0; i < 12; i++){
		for (j = 0; j < 12; j++){//12 lines
			for (k = 0; k < 8/4; k++){//8 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc((p0<<4) | p1,fout);fputc((p2<<4) | p3,fout);
			}
			fseek(fin,8+16,SEEK_CUR);
			if (j == 5) fseek(fin,-11*16,SEEK_CUR);
		}
		fseek(fin,-16,SEEK_CUR);
	}
	
	//6x16  2 frames (beer can)
	for (i = 0; i < 2; i++){
		for (j = 0; j < 16; j++){//16 lines
			//6 pixels
			p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
			fputc((p0<<4) | p1,fout);fputc((p2<<4) | p3,fout);
			p0 = fgetc(fin);p1 = fgetc(fin);
			fputc((p0<<4) | p1,fout);
			fseek(fin,10+16,SEEK_CUR);
			if (j == 7) fseek(fin,-15*16,SEEK_CUR);
		}
		fseek(fin,-16,SEEK_CUR);
	}
	
	//8x16  2 frames (bart)
	for (i = 0; i < 2; i++){
		for (j = 0; j < 16; j++){//16 lines
			for (k = 0; k < 8/4; k++){//8 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc((p0<<4) | p1,fout);fputc((p2<<4) | p3,fout);
			}
			fseek(fin,8+16,SEEK_CUR);
			if (j == 7) fseek(fin,-15*16,SEEK_CUR);
		}
		fseek(fin,-16,SEEK_CUR);
	}
	
	//16x22  4 frames (bart + can)
	for (i = 0; i < 4; i++){
		for (j = 0; j < 22; j++){//22 lines
			for (k = 0; k < 16/4; k++){//16 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc((p0<<4) | p1,fout);fputc((p2<<4) | p3,fout);
			}
			fseek(fin,16,SEEK_CUR);
			if (j == 10) fseek(fin,-21*16,SEEK_CUR);
		}
		fseek(fin,-16,SEEK_CUR);
	}
	
	//8x6  2 frames (tip)
	for (i = 0; i < 2; i++){
		for (j = 0; j < 6; j++){//6 lines
			for (k = 0; k < 8/4; k++){//8 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc((p0<<4) | p1,fout);fputc((p2<<4) | p3,fout);
			}
			fseek(fin,8+16,SEEK_CUR);
			if (j == 2) fseek(fin,-5*16,SEEK_CUR);
		}
		fseek(fin,-16,SEEK_CUR);
	}
	
	//4x8  12 frames (coins ?)
	for (i = 0; i < 12; i++){
		for (j = 0; j < 8; j++){//8 lines
			for (k = 0; k < 4/4; k++){//4 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc((p0<<4) | p1,fout);fputc((p2<<4) | p3,fout);
			}
			fseek(fin,12+16,SEEK_CUR);
			if (j == 3) fseek(fin,-7*16,SEEK_CUR);
		}
		fseek(fin,-16,SEEK_CUR);
	}
	
	//8x16  8 frames (explosion and falling jar)
	for (i = 0; i < 8; i++){
		for (j = 0; j < 16; j++){//12 lines
			for (k = 0; k < 8/4; k++){//8 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc((p0<<4) | p1,fout);fputc((p2<<4) | p3,fout);
			}
			fseek(fin,8+16,SEEK_CUR);
			if (j == 7) fseek(fin,-15*16,SEEK_CUR);
		}
		fseek(fin,-16,SEEK_CUR);
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header[] = {
		0x19,0x00,0x34,0x00,0x74,0x00,0x54,0x00,0x94,0x00,0x14,0x01,0xB4,0x00,0x94,0x02,
		0x34,0x02,0xD4,0x01,0x74,0x01,0xF4,0x02,0x54,0x03,0xD4,0x03,0x34,0x05,0x94,0x06,
		0xC4,0x06,0xE4,0x06,0x04,0x07,0x24,0x07,0x44,0x07,0x64,0x07,0x84,0x07,0x04,0x08,
		0x84,0x08,0x04,0x09,0x00,0x00,0x00,0x00,0xFF,0xFC,0xC3,0x1C,0x00,0x00,0x00,0xA0,
		0xC3,0xCC,0xC9,0x9C,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF3,0x1F,0xFF,0xFF,0xFF,0xAF,
		0xF3,0xCF,0xC9,0x9F,0x00,0x00,0x00,0x00,0xFF,0xFC,0xD3,0x0C,0x00,0x00,0x28,0x00,
		0xCF,0x0C,0xD9,0x8C,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xD3,0x3F,0xFF,0xFF,0xEB,0xFF,
		0xCF,0x3F,0xD9,0x8F,0x00,0x00,0x99,0xBC,0xFF,0xFE,0xD9,0x9C,0x1B,0xF0,0x89,0xDB,
		0xD9,0x9C,0xD9,0x9C,0xFF,0xFF,0x99,0xBF,0xFF,0xFE,0xD9,0x9F,0xDB,0xFF,0x89,0xDB,
		0xD9,0x9F,0xD9,0x9F,0x00,0x00,0xF9,0x98,0xFF,0xFC,0xD9,0x9C,0x3F,0x90,0xAD,0x88,
		0xD9,0x9C,0xD9,0x9C,0xFF,0xFF,0xF9,0x9B,0xFF,0xFF,0xD9,0x9F,0xFF,0x9F,0xAD,0x8B,
		0xD9,0x9F,0xD9,0x9F
	};
	
	fwrite(header,sizeof(unsigned char),0xB4,fout);
	
	
	fclose(fin);
	fclose(fout);
}

void Insert_NTSC_Moe(const char *bmp,const char *data,int frames){
	int i,j,k;
	unsigned long lines = 0;
	unsigned long offset = 0;
	unsigned char sprite[16];
	unsigned short pix,p0,p1,p2,p3;
	FILE *fin = fopen(bmp,"rb");
	FILE *fout = fopen(data,"wb");
	fseek(fin,0x7A,SEEK_SET);
	fseek(fout,0x86 ,SEEK_SET);
	
	//16x16x66 frames
	for (i = 0; i < frames; i++){
		for (j = 0; j < 16; j++){//16 lines
			for (k = 0; k < 16/4; k++){//32 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc((p0<<4) | p1,fout);fputc((p2<<4) | p3,fout);
			}
			fseek(fin,16,SEEK_CUR);
			if (j == 7) fseek(fin,-15*16,SEEK_CUR);
		}
		fseek(fin,-16,SEEK_CUR);
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header[] = {
		0x42,0x00,0x86,0x00,0x06,0x01,0x86,0x01,0x06,0x02,0x86,0x02,0x06,0x03,0x86,0x03,
		0x06,0x04,0x86,0x04,0x06,0x05,0x86,0x05,0x06,0x06,0x86,0x06,0x06,0x07,0x86,0x07,
		0x06,0x08,0x86,0x08,0x06,0x09,0x86,0x09,0x06,0x0A,0x86,0x0A,0x06,0x0B,0x86,0x0B,
		0x06,0x0C,0x86,0x0C,0x06,0x0D,0x86,0x0D,0x06,0x0E,0x86,0x0E,0x06,0x0F,0x86,0x0F,
		0x06,0x10,0x86,0x10,0x06,0x11,0x86,0x11,0x06,0x12,0x86,0x12,0x06,0x13,0x86,0x13,
		0x06,0x14,0x86,0x14,0x06,0x15,0x86,0x15,0x06,0x16,0x86,0x16,0x06,0x17,0x86,0x17,
		0x06,0x18,0x86,0x18,0x06,0x19,0x86,0x19,0x06,0x1A,0x86,0x1A,0x06,0x1B,0x86,0x1B,
		0x06,0x1C,0x86,0x1C,0x06,0x1D,0x86,0x1D,0x06,0x1E,0x86,0x1E,0x06,0x1F,0x86,0x1F,
		0x06,0x20,0x86,0x20,0x06,0x21
	};
	unsigned char header1[] = {
		0x42,0x00,0x86,0x00,0x06,0x01,0x86,0x01,0x06,0x02,0x86,0x02,0x06,0x03,0x86,0x03,
		0x06,0x04,0x86,0x04,0x06,0x05,0x86,0x05,0x06,0x06,0x86,0x06,0x06,0x07,0x86,0x07,
		0x06,0x08,0x86,0x08,0x06,0x09,0x86,0x09,0x06,0x0A,0x86,0x0A,0x06,0x0B,0x86,0x0B,
		0x06,0x0C,0x86,0x0C,0x06,0x0D,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x86,0x0D,
		0x06,0x0E,0x86,0x0E,0x06,0x0F,0x86,0x0F,0x06,0x10,0x86,0x10,0x06,0x11,0x86,0x11,
		0x06,0x12,0x86,0x12,0x06,0x13,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x86,0x13,0x06,0x14,0x86,0x14,0x06,0x15,0x86,0x15,
		0x06,0x16,0x86,0x16,0x06,0x17
	};
	if (frames == 66) fwrite(header,sizeof(unsigned char),0x86,fout);
	if (frames == 46) fwrite(header1,sizeof(unsigned char),0x86,fout);
	
	fclose(fin);
	fclose(fout);
}

void Insert_NTSC_Dancers(const char *bmp,const char *data){
	int i,j,k;
	unsigned long lines = 0;
	unsigned long offset = 0;
	unsigned char sprite[16];
	unsigned short pix,p0,p1,p2,p3;
	FILE *fin = fopen(bmp,"rb");
	FILE *fout = fopen(data,"wb");
	fseek(fin,0x7A,SEEK_SET);
	fseek(fout,0x10,SEEK_SET);
	
	//56x32x7 frames
	
	for (i = 0; i < 7; i++){
		for (j = 0; j < 32; j++){//32 lines
			for (k = 0; k < 28/4; k++){//56 pixels
				p0 = fgetc(fin);p1 = fgetc(fin);p2 = fgetc(fin);p3 = fgetc(fin);
				fputc((p0<<4) | p1,fout);fputc((p2<<4) | p3,fout);
			}
			fseek(fin,28,SEEK_CUR);
			if (j == 15) fseek(fin,-31*28,SEEK_CUR);
		}
		fseek(fin,-28,SEEK_CUR);
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header[] = {
		0x07,0x00,0x10,0x00,0xD0,0x01,0x90,0x03,0x50,0x05,0x10,0x07,0xD0,0x08,0x90,0x0A
	};
	
	fwrite(header,sizeof(unsigned char),0x10,fout);
	
	
	fclose(fin);
	fclose(fout);
}

void Delete_NTSC_Doors(){
	int i,j,k;
	unsigned long lines = 0;
	unsigned long offset = 0;
	unsigned char sprite[16];
	unsigned short pix,p0,p1,p2,p3;
	FILE *fout = fopen("NTSCDATA.009","wb");
	fseek(fout,0x42,SEEK_SET);
	
	//12x22  x32 frames
	
	for (i = 0; i < 16; i++){
		for (j = 0; j < 22*(24/4); j++)fputc(0x00,fout);//22 lines
		for (j = 0; j < 22*(24/4); j++)fputc(0xFF,fout);//22 lines	
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header[] = {
		0x20,0x00,0x42,0x00,0xC6,0x00,0x4A,0x01,0xCE,0x01,0x52,0x02,0xD6,0x02,0x5A,0x03,
		0xDE,0x03,0x62,0x04,0xE6,0x04,0x6A,0x05,0xEE,0x05,0x72,0x06,0xF6,0x06,0x7A,0x07,
		0xFE,0x07,0x82,0x08,0x06,0x09,0x8A,0x09,0x0E,0x0A,0x92,0x0A,0x16,0x0B,0x9A,0x0B,
		0x1E,0x0C,0xA2,0x0C,0x26,0x0D,0xAA,0x0D,0x2E,0x0E,0xB2,0x0E,0x36,0x0F,0xBA,0x0F,
		0x3E,0x10
	};
	
	fwrite(header,sizeof(unsigned char),0x42,fout);
	
	fclose(fout);
}

void Insert_NTSC_BKG(const char *bmp,const char *data){
	int i,j;
	unsigned long offset = 0;
	unsigned short line = 0;
	unsigned char pix1,pix2;
	FILE *fin = fopen(bmp,"rb");
	FILE *fout = fopen(data,"wb");

	//Write even lines
	fseek(fin,0x7A,SEEK_SET);
	fseek(fout,0x12,SEEK_SET);
	
	//Some padding
	fputc(0x77,fout);fputc(0x77,fout);
	
	while (offset < 80*101){
		pix1 = fgetc(fin);
		pix2 = fgetc(fin);
		fputc((pix1<<4) | pix2,fout);
		offset++;
		line++;
		if (line == 80) {line = 0; fseek(fin,160,SEEK_CUR);}
	}
	
	//Some padding
	for (int i = 1; i < 113; i++) fputc(0x77,fout);
	
	//Write odd lines
	offset = 0;
	line = 0;
	fseek(fin,0x7A+160,SEEK_SET);
	
	while (offset < 80*100){
		pix1 = fgetc(fin);
		pix2 = fgetc(fin);
		fputc((pix1<<4) | pix2,fout);
		offset++;
		line++;
		if (line == 80) {line = 0; fseek(fin,160,SEEK_CUR);}
	}
	
	fseek(fout,0x00,SEEK_SET);
	unsigned char header[] = {
		0x1F,0x0C,0x00,0x00,0x11,0x11,0x66,0x66,0x55,0x55,0x00,0x00,0x44,0x44,0x22,0x22,0x55,0x55
	};
	
	fwrite(header,sizeof(unsigned char),0x12,fout);
	fclose(fin);
	fclose(fout);
}


int main(){


	Insert_RGBI_BKG("Logo.bmp","RGBIDATA.002",1);
	Insert_RGBI_Clients();//RGBIDATA.003
	Insert_RGBI_Moe();//RGBIDATA.004
	Insert_RGBI_Dancers();//RGBIDATA.005
	Delete_RGBI_Doors();//RGBIDATA.006
	Insert_RGBI_Misc();//RGBIDATA.007
	Insert_RGBI_BKG("Minigame.bmp","RGBIDATA.008",1);
	Insert_RGBI_BKG("Level0.bmp","RGBIDATA.009",1);
	Insert_RGBI_BKG("Level1.bmp","RGBIDATA.010",2);
	Insert_RGBI_BKG("Level2.bmp","RGBIDATA.011",1);
	Insert_RGBI_BKG("Level3.bmp","RGBIDATA.012",1);
	Insert_RGBI_BKG("Level4.bmp","RGBIDATA.013",1);
	Insert_RGBI_BKG("Level5.bmp","RGBIDATA.014",1);
	
	
	Insert_NTSC_BKG("LogoColor.bmp","NTSCDATA.002");
	Insert_NTSC_Clients("ClientsColor.bmp","NTSCDATA.003");
	Insert_NTSC_Clients("ClientsColor1.bmp","NTSCDATA.004");
	Insert_NTSC_Moe("MoeColor.bmp","NTSCDATA.005",66);
	Insert_NTSC_Moe("MoeColor1.bmp","NTSCDATA.006",46);
	Insert_NTSC_Dancers("DancersColor.bmp","NTSCDATA.007");
	Insert_NTSC_Dancers("DancersColor.bmp","NTSCDATA.008");
	Delete_NTSC_Doors();//NTSCDATA.009
	Insert_NTSC_Misc();//NTSCDATA.010
	Insert_NTSC_BKG("MinigameColor.bmp","NTSCDATA.011");
	Insert_NTSC_BKG("Level0Color.bmp","NTSCDATA.012");
	Insert_NTSC_BKG("Level0ColorFlip.bmp","NTSCDATA.013");
	Insert_NTSC_BKG("Level1Color.bmp","NTSCDATA.014");
	Insert_NTSC_BKG("Level2Color.bmp","NTSCDATA.015");
	Insert_NTSC_BKG("Level3Color.bmp","NTSCDATA.016");
	Insert_NTSC_BKG("Level4Color.bmp","NTSCDATA.017");
	Insert_NTSC_BKG("Level5Color.bmp","NTSCDATA.018");
	
	
	return 0;
}